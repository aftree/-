# Untitled

## [进程间通讯IPC的几种方式总结](https://www.cnblogs.com/WindSun/p/11441090.html)

### Linux进程间的通讯 <a id="linux&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x8BAF;"></a>

Unix发展做出重大贡献的两大主力AT&T的贝尔实验室及BSD（加州大学伯克利分校的伯克利软件发布中心）在进程间通信方面的侧重点有所不同。前者对Unix早期的进程间通信手段进行了系统的改进和扩充，形成了“system V IPC”，通信进程局限在单个计算机内；后者则跳过了该限制，形成了基于套接口（socket）的进程间通信机制。Linux则把两者继承了下来，如图示：

![&#x56FE;1 Linux&#x7EE7;&#x627F;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x8BAF;](https://ask.qcloudimg.com/draft/6064128/2c08936jzk.png)

### 管道 <a id="&#x7BA1;&#x9053;"></a>

管道的通信介质是文件，这种文件通常称为管道文件，两个进程利用管道文件进行通信时，一个进程为写进程，另一个进程为读进程。写进程通过写端（发送端）往管道文件中写入信息；读进程通过读端（接收端）从管道文件中读取信息。两个进程协调不断地进行写、读，便会构成双方通过管道传递信息的流水线。

#### 匿名管道pipe <a id="&#x533F;&#x540D;&#x7BA1;&#x9053;pipe"></a>

匿名管道是半双工的，数据只能单向通信；需要双方通信时，需要建立起两个管道；只能用于父子进程或者兄弟进程之间（具有亲缘关系的进程）。

#### 命名管道fifo <a id="&#x547D;&#x540D;&#x7BA1;&#x9053;fifo"></a>

不同于匿名管道之处在于它提供一个路径名与之关联，以FIFO的文件形式存在于文件系统中。这样，即使与FIFO的创建进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过FIFO相互通信（能够访问该路径的进程以及FIFO的创建进程之间），因此，通过FIFO不相关的进程也能交换数据。值得注意的是，FIFO严格遵循先进先出（first in first out），对管道及FIFO的读总是从开始处返回数据，对它们的写则把数据添加到末尾。

### 信号 <a id="&#x4FE1;&#x53F7;"></a>

信号是一种比较复杂的通信方式，信号产生的条件：按键、硬件异常、进程调用kill函数将信号发送给另一个进程、用户调用kill命令将信号发送给其他进程，信号传递的消息比较少，主要用于通知接收进程某个时间已经发生。

### 消息队列 <a id="&#x6D88;&#x606F;&#x961F;&#x5217;"></a>

消息队列是消息的链表，存放在内核中并由消息队列标识符标识，消息队列克服了信号传递信息少，管道只能承载无格式字节流以及缓冲区大小受限等特点。消息队列起信箱作用，到了就挂在那里，需要的时候去取。消息队列提供了一种在两个不相关进程间传递数据的简单有效的方法。与命名管道相比：消息队列的优势在于，它独立于发送和接收进程而存在，这消除了在同步命名管道的打开和关闭时可能产生的一些困难。消息队列提供了一种从一个进程向另一个进程发送一个数据块的方法。而且，每个数据块被认为含有一个类型，接收进程可以独立地接收含有不同类型值的数据块。

优点：

      A. 我们可以通过发送消息来几乎完全避免命名管道的同步和阻塞问题。

      B. 我们可以用一些方法来提前查看紧急消息。

缺点：

      A. 与管道一样，每个数据块有一个最大长度的限制。

      B. 系统中所有队列所包含的全部数据块的总长度也有一个上限。

Linux系统中有两个宏定义:

> MSGMAX, 以字节为单位，定义了一条消息的最大长度。  
> MSGMNB, 以字节为单位，定义了一个队列的最大长度。

### 共享内存 <a id="&#x5171;&#x4EAB;&#x5185;&#x5B58;"></a>

共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的IPC方式，它是针对其他进程间通信方式运行效率低而专门设计的。访问共享内存区域和访问进程独有的内存区域一样快，并不需要通过系统调用或者其它需要切入内核的过程来完成。同时它也避免了对数据的各种不必要的复制。共享内存块提供了在任意数量的进程之间进行高效双向通信的机制。每个使用者都可以读取写入数据，往往与其他通信机制，如信号量配合使用，来实现进程间的同步和通信。而它的局限性也在于此．即共享内存的诸进程必须共处同一个计算机系统．有物理内存可以共享才行。共享在共享大数据文件时有用，直接在相同进行内存的拷贝，速度快，效率高，需要考虑访问临界资源并发同步。共享内存区是最快的可用IPC形式，一旦这样的内存区映射到共享它的进程的地址空间，这些进程间数据的传递就不再通过执行任何进入内核的系统调用来传递彼此的数据，节省了时间。

共享内存和消息队列，FIFO，管道传递消息的区别：

消息队列，FIFO，管道的消息传递方式一般为

> 1：服务器得到输入  
> 2：通过管道，消息队列写入数据，通常需要从进程拷贝到内核。  
> 3：客户从内核拷贝到进程  
> 4：然后再从进程中拷贝到输出文件

上述过程通常要经过4次拷贝，才能完成文件的传递。

共享内存只需要

> 1:从输入文件到共享内存区  
> 2:从共享内存区输出到文件

上述过程不涉及到内核的拷贝，所以花的时间较少。

### 本地套接字 <a id="&#x672C;&#x5730;&#x5957;&#x63A5;&#x5B57;"></a>

进程间通信的一种方式是使用UNIX套接字sockaddr\_un，人们在使用这种方式时往往用的不是网络套接字，而是一种称为本地套接字的方式。本地套接字用于本地进程间的通讯更安全和稳定。

使用套接字函数socket创建，不过传递的参数与网络套接字不同。域参数应该是PF\_LOCAL或者PF\_UNIX，而不能用PF\_INET之类。本地套接字的通讯类型应该是SOCK\_STREAM或SOCK\_DGRAM，协议为默认协议。

创建了套接字后，还必须进行绑定才能使用。不同于网络套接字的绑定，本地套接字的绑定的是struct sockaddr\_un结构。struct sockaddr\_un结构有两个参数：sun\_family、sun\_path。sun\_family只能是AF\_LOCAL或AF\_UNIX，而sun\_path是本地文件的路径。通常将文件放在/tmp目录下。

本地套接字的其他操作都与网络套接字相似。  


